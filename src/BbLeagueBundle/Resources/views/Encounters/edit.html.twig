{% extends 'BbLeagueBundle:Layout:layout.html.twig' %}
{% form_theme sheet 'BbLeagueBundle:Form:form_div_layout.html.twig' %}
{% set dictionnary = encounter.journey.league.rule %}
{% block body %}

<section id="content-form" class="content normal-content clearfix">
    <header class="section-header clearfix padding-me">
        <h1 class="section-title">{% trans from 'form' %}form.encounter.sheet.title{% endtrans %}</h1>
    </header>
    <div id="encoutersheet" class="clearfix">
    {{ form_start(sheet, {attr: {class: 'ui form'}}) }}
        {{ form_errors(sheet) }}
        <div class="ui two column stackable grid clearfix">
            <div class="left-part column home">
                <div class="head-informations">
                    {% if encounter.team.logo %}
                    <span class="team-logo">
                        <img src="{{ encounter.team.webPath | imagine_filter('dashboard_logo') }}" />
                    </span>
                    {% else %}
                    <span class="team-logo no-logo">
                        {{ include('BbLeagueBundle:Layout:Icons/logo-league.html.twig') }}
                    </span>
                    {% endif %}
                    <h2>{{ encounter.team.name }}</h2>
                    <div class="core clearfix">
                        <div class="tr clearfix base-stat-table center-all big-value">
                            <span class="label">{{ 'layout.values.tr'|trans }}</span>
                            <span class="value">{{ encounter.team.getLastJourney ? encounter.team.getLastJourney.tr : '0' }}</span>
                        </div>
                        <div class="treasure clearfix base-stat-table center-all big-value">
                            <span class="label">{{ 'layout.values.treasure'|trans }}</span>
                            <span class="value">{{ encounter.team.getLastJourney ? encounter.team.getLastJourney.treasure|bbkpo(dictionnary)|raw : '-' }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="right-part column visitor">
                <div class="head-informations">
                    {% if encounter.visitor.logo %}
                    <span class="team-logo">
                        <img src="{{ encounter.visitor.webPath | imagine_filter('dashboard_logo') }}" />
                    </span>
                    {% else %}
                    <span class="team-logo no-logo">
                        {{ include('BbLeagueBundle:Layout:Icons/logo-league.html.twig') }}
                    </span>
                    {% endif %}
                    <h2>{{ encounter.visitor.name }}</h2>
                    <div class="core clearfix">
                        <div class="tr clearfix base-stat-table center-all big-value">
                            <span class="label">{{ 'layout.values.tr'|trans }}</span>
                            <span class="value">{{ encounter.visitor.getLastJourney ? encounter.visitor.getLastJourney.tr : '0' }}</span>
                        </div>
                        <div class="treasure clearfix base-stat-table center-all big-value">
                            <span class="label">{{ 'layout.values.treasure'|trans }}</span>
                            <span class="value">{{ encounter.visitor.getLastJourney ? encounter.visitor.getLastJourney.treasure|bbkpo(dictionnary)|raw : '-' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% include 'BbLeagueBundle:Encounters:form/step1.html.twig' %}
        {% include 'BbLeagueBundle:Encounters:form/step2.html.twig' %}
        {% include 'BbLeagueBundle:Encounters:form/step3.html.twig' %}
        <div class="field">
            {{form_widget(sheet.save, {'label': 'form.encounter.sheet.submit', 'attr': {class: 'ui button'}})}}
        </div>
    {{ form_end(sheet) }}
    </div>
</section>
{% endblock body %}
{% block javascripts %}
<script type="text/javascript">
    // keep track of how many email fields have been rendered

    $(document).ready(function() {
        $('#encoutersheet select').dropdown();
        $('#encoutersheet .add-another-action').click(function(e) {
            e.preventDefault();

            var thelist  = $( $(e.target).attr('list-selector') );
            var thecount = parseInt( $(e.target).attr('list-count') );
            // grab the prototype template
            var newWidget = thelist.attr('data-prototype');
            // replace the "__name__" used in the id and name of the prototype
            // with a number that's unique to your emails
            // end name attribute looks like name="contact[emails][2]"
            newWidget = newWidget.replace(/__name__/g, thecount);
            $(e.target).attr('list-count', thecount+1);

            // create a new list element and add it to the list
            var newLi = $('<li></li>').html(newWidget);
            newLi.append('<a href="#" class="delrow">Delete row</a>');
            newLi.appendTo(thelist);
            $( "a.delrow", newLi ).click( function(e) {
                e.preventDefault();
                newLi.remove();
            });
            $('select', newLi).dropdown();
        });
        $( "#encounter a.delrow" ).click( function(e) {
            e.preventDefault();
            e.target.parent().remove();
        });
    })
</script>
{% endblock javascripts %}
